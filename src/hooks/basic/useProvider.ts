import { UnwrapRef } from "vue";

interface ProviderOptions {
  isReadonly?: boolean;
}

type ShallowUnwrap<T> = {
  [P in keyof T]: UnwrapRef<T[P]>;
};

export function createProvider<T>(
  key: InjectionKey<T> = Symbol(),
  value: any,
  options: ProviderOptions = {}
) {
  const { isReadonly = true } = options;
  const state = reactive(value);
  const provideValue = isReadonly ? readonly(state) : state;
  provide(key, provideValue);
}
export function useProvider<T>(
  key: InjectionKey<T> = Symbol(),
  defaultValue?: any
): ShallowUnwrap<T> {
  return inject(key, defaultValue || {});
}
